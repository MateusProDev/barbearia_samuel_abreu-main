<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Verificador de Estrutura - Firestore</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #4CAF50; }
        .error { background: #f44336; }
        .info { background: #2196F3; }
        .warning { background: #FF9800; }
        .btn {
            background: #D4AF37;
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
        }
        .collection {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #D4AF37;
        }
    </style>
</head>
<body>
    <h1>üîß Verificador de Estrutura Firestore</h1>
    <p>Este verificador analisa seu banco de dados e garante que tudo esteja configurado corretamente.</p>
    
    <button class="btn" onclick="verificarEstrutura()">üîç Verificar Estrutura</button>
    <button class="btn" onclick="criarSecoesFaltantes()" id="criarBtn" style="display:none;">‚ûï Criar Se√ß√µes Faltantes</button>
    
    <div id="resultados"></div>

    <script>
        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCTcvqfii2TE08vqolCgqv0jI9VWTfarOA",
            authDomain: "barbeariasamuelabreu.firebaseapp.com",
            projectId: "barbeariasamuelabreu",
            storageBucket: "barbeariasamuelabreu.firebasestorage.app",
            messagingSenderId: "690733163957",
            appId: "1:690733163957:web:c3f77d1219a81eeeb6e5fc"
        };

        let db;
        let secoesFaltantes = [];

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        db = firebase.firestore();

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('resultados').appendChild(div);
        }

        async function verificarEstrutura() {
            document.getElementById('resultados').innerHTML = '';
            log('üîç Iniciando verifica√ß√£o da estrutura...', 'info');
            
            // Estrutura esperada baseada no que vi no seu banco
            const estruturaEsperada = {
                'images': 'Cole√ß√£o principal de imagens',
                'sections': 'Se√ß√µes do site (gallery, hero, services, team)',
                'settings': 'Configura√ß√µes do site',
                'siteContent': 'Conte√∫do principal (main, contact, schedule)',
                'users': 'Usu√°rios administrativos'
            };

            const secoesEsperadas = ['gallery', 'hero', 'services', 'team'];
            const documentosSiteContent = ['main', 'contact', 'schedule'];

            try {
                // Verificar cole√ß√µes principais
                for (const [colecao, descricao] of Object.entries(estruturaEsperada)) {
                    try {
                        const snapshot = await db.collection(colecao).limit(1).get();
                        if (snapshot.empty) {
                            log(`‚ö†Ô∏è Cole√ß√£o '${colecao}' existe mas est√° vazia - ${descricao}`, 'warning');
                        } else {
                            const total = await db.collection(colecao).get();
                            log(`‚úÖ Cole√ß√£o '${colecao}' OK - ${total.size} documentos - ${descricao}`, 'success');
                        }
                    } catch (error) {
                        log(`‚ùå Cole√ß√£o '${colecao}' com problema: ${error.message}`, 'error');
                    }
                }

                // Verificar se√ß√µes espec√≠ficas
                log('üîç Verificando se√ß√µes espec√≠ficas...', 'info');
                secoesFaltantes = [];
                
                for (const secao of secoesEsperadas) {
                    try {
                        const doc = await db.collection('sections').doc(secao).get();
                        if (!doc.exists) {
                            log(`‚ö†Ô∏è Se√ß√£o '${secao}' n√£o encontrada`, 'warning');
                            secoesFaltantes.push(secao);
                        } else {
                            log(`‚úÖ Se√ß√£o '${secao}' configurada`, 'success');
                        }
                    } catch (error) {
                        log(`‚ùå Erro ao verificar se√ß√£o '${secao}': ${error.message}`, 'error');
                        secoesFaltantes.push(secao);
                    }
                }

                // Verificar documentos do siteContent
                log('üîç Verificando documentos do siteContent...', 'info');
                for (const doc of documentosSiteContent) {
                    try {
                        const documento = await db.collection('siteContent').doc(doc).get();
                        if (!documento.exists) {
                            log(`‚ö†Ô∏è Documento siteContent/'${doc}' n√£o encontrado`, 'warning');
                        } else {
                            log(`‚úÖ Documento siteContent/'${doc}' OK`, 'success');
                        }
                    } catch (error) {
                        log(`‚ùå Erro ao verificar siteContent/'${doc}': ${error.message}`, 'error');
                    }
                }

                // Estat√≠sticas das imagens
                log('üìä Analisando distribui√ß√£o de imagens...', 'info');
                const imagesSnapshot = await db.collection('images').get();
                const distribuicao = {};
                
                imagesSnapshot.forEach(doc => {
                    const data = doc.data();
                    const secao = data.section || data.category || 'indefinida';
                    distribuicao[secao] = (distribuicao[secao] || 0) + 1;
                });

                Object.entries(distribuicao).forEach(([secao, count]) => {
                    log(`üìÅ Se√ß√£o '${secao}': ${count} imagens`, 'info');
                });

                if (secoesFaltantes.length > 0) {
                    log(`‚ö†Ô∏è ${secoesFaltantes.length} se√ß√µes precisam ser criadas: ${secoesFaltantes.join(', ')}`, 'warning');
                    document.getElementById('criarBtn').style.display = 'inline-block';
                } else {
                    log('üéâ Estrutura completa! Tudo configurado corretamente.', 'success');
                }

            } catch (error) {
                log(`‚ùå Erro na verifica√ß√£o: ${error.message}`, 'error');
            }
        }

        async function criarSecoesFaltantes() {
            log('üîß Criando se√ß√µes faltantes...', 'info');
            
            const secoesConfig = {
                'gallery': {
                    title: 'Galeria de Trabalhos',
                    subtitle: 'Veja o que sabemos fazer',
                    description: 'Portf√≥lio dos nossos melhores trabalhos',
                    order: 2,
                    visible: true
                },
                'hero': {
                    title: 'Hero Section',
                    subtitle: 'Banner Principal',
                    description: 'Se√ß√£o principal do site',
                    order: 0,
                    visible: true
                },
                'services': {
                    title: 'Nossos Servi√ßos',
                    subtitle: 'Qualidade profissional',
                    description: 'Servi√ßos oferecidos pela barbearia',
                    order: 1,
                    visible: true
                },
                'team': {
                    title: 'Nossa Equipe',
                    subtitle: 'Profissionais qualificados',
                    description: 'Conhe√ßa nossos barbeiros',
                    order: 3,
                    visible: true
                }
            };

            try {
                for (const secao of secoesFaltantes) {
                    const config = secoesConfig[secao];
                    if (config) {
                        await db.collection('sections').doc(secao).set({
                            ...config,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        log(`‚úÖ Se√ß√£o '${secao}' criada com sucesso`, 'success');
                    }
                }
                
                log('üéâ Todas as se√ß√µes foram criadas!', 'success');
                document.getElementById('criarBtn').style.display = 'none';
                
                // Re-verificar
                setTimeout(verificarEstrutura, 2000);
                
            } catch (error) {
                log(`‚ùå Erro ao criar se√ß√µes: ${error.message}`, 'error');
            }
        }

        // Auto-verificar ao carregar
        window.addEventListener('load', () => {
            setTimeout(verificarEstrutura, 1000);
        });
    </script>
</body>
</html>